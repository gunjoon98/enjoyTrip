<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.enjoyTrip.model.mapper.AttractionMapper">
    <select id="getKeywordList" resultType="Keyword">
        select code, keyword
        from keyword_info
    </select>

    <select id="getcityList" resultType="Map">
        select code, name as name
        from city
    </select>

    <select id="getAttractionList" parameterType="Map" resultMap="AttractionListMap">
        select
        a.id as a_id,
        a.title as a_title,
        a.address as a_address,
        a.overview as a_overview,
        i.image_path as main_image_path
        from attraction a
        left outer join keyword_match km on a.id = km.attraction_id
        inner join keyword_info k on km.keyword_code = k.code
        left outer join image_info i on a.id = i.attraction_id
        <where>
        <if test="kewordCodes != null">
            and k.code in
            <foreach collection="keywordCodes" item="item" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        <if test="cityCode != null">
            and a.city_code = #{cityCode}
        </if>
        and i.is_representative = true
        </where>
        order by a.id desc
        limit #{column}
    </select>

    <resultMap id="AttractionListMap" type="Attraction">
        <id column="a_id" property="id"/>
        <result column="a_title" property="title"/>
        <result column="a_address" property="address"/>
        <result column="a_overview" property="overview"/>
        <result column="main_image_path" property="mainImagePath"/>
    </resultMap>
</mapper>
