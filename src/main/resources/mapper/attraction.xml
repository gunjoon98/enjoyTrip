<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.enjoyTrip.model.mapper.AttracionMapper">
    <select id="getKeywordList" resultType="Keyword">
        select code, keyword
        from keyword_info
    </select>

    <select id="getSidoList" resultMap="sidoListMap">
        select
        s.sido_code as s_sido_code,
        s.sido_name as s_sido_name,
        g.gugun_code as g_gugun_code,
        g.gugun_name as g_gugun_name
        from sido s
        inner join gugun g on s.sido_code = g.sido_code
    </select>
    
    <select id="getAttractionList" parameterType="Map" resultMap="AttractionMap">
        select
        a.id as a_id,
        a.title as a_title,
        a.address as a_address,
        a.overview as a_overview,
        CONCAT('/', i.folder_name, '/', i.image_name) as main_image_path
        from attraction a
        left outer join keyword_match km on a.id = km.attraction_id
        inner join keyword_info k on km.keyword_code = k.code
        left outer join image_info i on a.id = i.attraction_id
        <where>
        <if test="kewordCodes != null">
            and k.code in
            <foreach collection="keywordCodes" item="item" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        <if test="sidoCode != null">
            and a.sidoCode = #{sidoCode}
        </if>
        <if test="gugunCode != null">
            and a.gugunCode = #{gugunCode}
        </if>
        and i.is_representative = true
        </where>
        order by a.id desc
        limit #{column}
    </select>

    <resultMap id="sidoListMap" type="Map">
        <id column="s_sido_code" property="sidoCode"/>
        <result column="s_sido_name" property="sidoName"/>
        <collection property="gugunList" ofType="Map" javaType="List">
            <id column="g_gugun_code" property="gugunCode"/>
            <result column="g_gugun_name" property="gugunName"/>
        </collection>
    </resultMap>
</mapper>